<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§ í…ŒìŠ¤íŠ¸</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #333;
            margin-top: 0;
        }
        button {
            background-color: #007cba;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #005a87;
        }
        .result {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            color: #28a745;
        }
        .error {
            color: #dc3545;
        }
        .info {
            color: #17a2b8;
        }
        .memory-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        .memory-item {
            background: #e9ecef;
            padding: 10px;
            border-radius: 4px;
        }
        .memory-item h4 {
            margin: 0 0 10px 0;
            color: #495057;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ§  ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ í…ŒìŠ¤íŠ¸</h1>
        <p>ì´ í˜ì´ì§€ëŠ” Electron ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§ ê¸°ëŠ¥ì„ í…ŒìŠ¤íŠ¸í•©ë‹ˆë‹¤.</p>

        <div class="test-section">
            <h3>1. ElectronAPI í™•ì¸</h3>
            <button onclick="checkElectronAPI()">ElectronAPI ìƒíƒœ í™•ì¸</button>
            <div id="api-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>2. ë©”ëª¨ë¦¬ ì •ë³´ ì¡°íšŒ</h3>
            <button onclick="getMemoryInfo()">ë©”ëª¨ë¦¬ ì •ë³´ ê°€ì ¸ì˜¤ê¸°</button>
            <button onclick="startMemoryMonitoring()">ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì‹œì‘</button>
            <button onclick="stopMemoryMonitoring()">ëª¨ë‹ˆí„°ë§ ì¤‘ì§€</button>
            <div id="memory-result" class="result"></div>
            <div id="memory-stats" class="memory-stats"></div>
        </div>

        <div class="test-section">
            <h3>3. ë©”ëª¨ë¦¬ ìµœì í™”</h3>
            <button onclick="optimizeMemory()">ë©”ëª¨ë¦¬ ìµœì í™” ì‹¤í–‰</button>
            <div id="optimize-result" class="result"></div>
        </div>

        <div class="test-section">
            <h3>4. ë„¤ì´í‹°ë¸Œ ëª¨ë“ˆ ìƒíƒœ</h3>
            <button onclick="getNativeStatus()">ë„¤ì´í‹°ë¸Œ ëª¨ë“ˆ ìƒíƒœ í™•ì¸</button>
            <div id="native-result" class="result"></div>
        </div>
    </div>

    <script>
        let monitoringInterval = null;

        function log(elementId, message, type = 'info') {
            const element = document.getElementById(elementId);
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            element.innerHTML += `<span class="${className}">[${timestamp}] ${message}</span>\n`;
            element.scrollTop = element.scrollHeight;
        }

        function clear(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }

        async function checkElectronAPI() {
            clear('api-result');
            
            if (typeof window === 'undefined') {
                log('api-result', 'ERROR: window ê°ì²´ê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            if (!window.electronAPI) {
                log('api-result', 'ERROR: window.electronAPIê°€ ì—†ìŠµë‹ˆë‹¤', 'error');
                return;
            }

            log('api-result', 'âœ… window.electronAPI ì‚¬ìš© ê°€ëŠ¥', 'success');
            
            // API ë©”ì„œë“œ í™•ì¸
            const methods = ['system', 'memory', 'native'];
            for (const method of methods) {
                if (window.electronAPI[method]) {
                    log('api-result', `âœ… electronAPI.${method} ì‚¬ìš© ê°€ëŠ¥`, 'success');
                } else {
                    log('api-result', `âŒ electronAPI.${method} ì—†ìŒ`, 'error');
                }
            }

            // ë©”ëª¨ë¦¬ ê´€ë ¨ ë©”ì„œë“œ ìƒì„¸ í™•ì¸
            if (window.electronAPI.memory) {
                const memoryMethods = ['getInfo', 'optimize', 'cleanup'];
                for (const method of memoryMethods) {
                    if (window.electronAPI.memory[method]) {
                        log('api-result', `âœ… electronAPI.memory.${method} ì‚¬ìš© ê°€ëŠ¥`, 'success');
                    } else {
                        log('api-result', `âŒ electronAPI.memory.${method} ì—†ìŒ`, 'error');
                    }
                }
            }
        }

        async function getMemoryInfo() {
            clear('memory-result');
            clear('memory-stats');
            
            try {
                log('memory-result', 'ë©”ëª¨ë¦¬ ì •ë³´ ìš”ì²­ ì¤‘...', 'info');
                
                if (!window.electronAPI || !window.electronAPI.memory) {
                    throw new Error('ElectronAPI ë˜ëŠ” memory APIë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
                }

                const result = await window.electronAPI.memory.getInfo();
                
                if (result.success) {
                    log('memory-result', 'âœ… ë©”ëª¨ë¦¬ ì •ë³´ ì¡°íšŒ ì„±ê³µ', 'success');
                    log('memory-result', JSON.stringify(result.data, null, 2), 'info');
                    
                    // ë©”ëª¨ë¦¬ í†µê³„ ì‹œê°í™”
                    displayMemoryStats(result.data);
                } else {
                    log('memory-result', `âŒ ë©”ëª¨ë¦¬ ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                log('memory-result', `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                console.error('Memory info error:', error);
            }
        }

        function displayMemoryStats(data) {
            const statsContainer = document.getElementById('memory-stats');
            
            const items = [
                { title: 'Main Process', data: data.main },
                { title: 'Renderer Process', data: data.renderer },
                { title: 'System Memory', data: data.system }
            ];

            if (data.gpu) {
                items.push({ title: 'GPU Memory', data: data.gpu });
            }

            statsContainer.innerHTML = items.map(item => `
                <div class="memory-item">
                    <h4>${item.title}</h4>
                    <div>Used: ${item.data.used}MB</div>
                    <div>Total: ${item.data.total}MB</div>
                    <div>Free: ${item.data.free}MB</div>
                    <div>Usage: ${item.data.percentage.toFixed(1)}%</div>
                </div>
            `).join('');
        }

        async function optimizeMemory() {
            clear('optimize-result');
            
            try {
                log('optimize-result', 'ë©”ëª¨ë¦¬ ìµœì í™” ì‹œì‘...', 'info');
                
                const result = await window.electronAPI.memory.optimize();
                
                if (result.success) {
                    log('optimize-result', 'âœ… ë©”ëª¨ë¦¬ ìµœì í™” ì™„ë£Œ', 'success');
                    log('optimize-result', result.message, 'info');
                } else {
                    log('optimize-result', `âŒ ë©”ëª¨ë¦¬ ìµœì í™” ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                log('optimize-result', `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                console.error('Memory optimize error:', error);
            }
        }

        async function getNativeStatus() {
            clear('native-result');
            
            try {
                log('native-result', 'ë„¤ì´í‹°ë¸Œ ëª¨ë“ˆ ìƒíƒœ í™•ì¸ ì¤‘...', 'info');
                
                const result = await window.electronAPI.system.native.getStatus();
                
                if (result.success) {
                    log('native-result', 'âœ… ë„¤ì´í‹°ë¸Œ ëª¨ë“ˆ ìƒíƒœ ì¡°íšŒ ì„±ê³µ', 'success');
                    log('native-result', JSON.stringify(result.data, null, 2), 'info');
                } else {
                    log('native-result', `âŒ ë„¤ì´í‹°ë¸Œ ëª¨ë“ˆ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨: ${result.error}`, 'error');
                }
            } catch (error) {
                log('native-result', `âŒ ì˜¤ë¥˜ ë°œìƒ: ${error.message}`, 'error');
                console.error('Native status error:', error);
            }
        }

        function startMemoryMonitoring() {
            if (monitoringInterval) {
                log('memory-result', 'ì´ë¯¸ ëª¨ë‹ˆí„°ë§ì´ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤', 'info');
                return;
            }

            log('memory-result', 'ğŸ”„ ì‹¤ì‹œê°„ ë©”ëª¨ë¦¬ ëª¨ë‹ˆí„°ë§ ì‹œì‘', 'success');
            
            monitoringInterval = setInterval(async () => {
                try {
                    const result = await window.electronAPI.memory.getInfo();
                    if (result.success) {
                        displayMemoryStats(result.data);
                    }
                } catch (error) {
                    console.error('Monitoring error:', error);
                }
            }, 2000); // 2ì´ˆë§ˆë‹¤ ì—…ë°ì´íŠ¸
        }

        function stopMemoryMonitoring() {
            if (monitoringInterval) {
                clearInterval(monitoringInterval);
                monitoringInterval = null;
                log('memory-result', 'â¹ï¸ ì‹¤ì‹œê°„ ëª¨ë‹ˆí„°ë§ ì¤‘ì§€', 'info');
            }
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ìœ¼ë¡œ API ìƒíƒœ í™•ì¸
        window.addEventListener('load', () => {
            setTimeout(checkElectronAPI, 1000);
        });
    </script>
</body>
</html>
